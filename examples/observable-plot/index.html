<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
    <link rel="stylesheet" href="observable-plot.css">
</head>

<body>

<div id="target"></div>


<script type = "module">

    import * as bb from '../../build/board-box.js'
    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
    import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";

    
    class Scatter extends bb.Component {

        constructor(options) {
            super(options);
            this.dataId = options.dataId;
        }

        make() {
            const div = d3.select(`#${this.parentId}`);
            div.append("div")
                .attr("class", `${this.containerClassName}`)
                .style("position", "absolute");
            this.setContainerSize();  
            this.update();
        }

        update() {
            const plotArea = d3.select(`#${this.parentId}`).select(`.${this.containerClassName}`);
            plotArea.selectChildren().remove();
            this.setContainerSize();
            const data = this.sharedStateByAncestorId['context'].data[this.dataId];
            const plot = Plot.plot({
                width: this.containerWidth,
                height: this.containerHeight,
                marks: [
                    Plot.dot(data, {x: "x", y: "y"}),
                    Plot.ruleX([0]),
                    Plot.ruleY([0])
                ]
            });
            plotArea.node().append(plot);

        }
    }
    
    function randomData() {
        const data = [];
        for (let i = 0; i < 100; i++) {
            data.push({x: Math.random(), y: Math.random()});
        }
        return data;
    }

    const ctx = new bb.Context();
    ctx.sharedState.data={};
    ctx.sharedState.data['random'] = randomData();

    const board = new bb.Board({widthPerCent:100, height:600});
    ctx.addBoard(board);

    const box1 = new bb.Box({position:{x:250,y:0}, width:500, height:500,autoLayout:true});
    board.addBox(box1);

    box1.addBox( new bb.Box({position:{x:10,y:15}, width:200, height:200, margin:4, component:new Scatter({dataId:'random'})  }));
    box1.addBox( new bb.Box({position:{x:100,y:25}, width:200, height:200, margin:4, component:new Scatter({dataId:'random'})  }));
    box1.addBox( new bb.Box({position:{x:10,y:250}, width:200, height:200, margin:4, component:new Scatter({dataId:'random'})  }));
    
    console.log(board);
    board.make();

</script>

</body>
</html>


